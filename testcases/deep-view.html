<h2>deep-view : </h2>
<script type="text/javascript">
	//console.log("deep-copy.html loaded : ");
(function(){
	var deepEqual = require("deep/utils").deepEqual;
	var ViewController = require("deep-ui/view-controller");
	var ListController = require("deep-ui/list-controller");
	var promise = require("deep/promise");
	require("test-controller.js")
	var success = 0;
	var failed = 0;
	var count = 0;

	function doDeepEqualTest(title, a, b, resultNeeded)
	{
		count++;
		$("#content-container").append("<br/>("+count+") <strong>"+title+"</strong><br/>");
		$("#content-container").append("a : "+JSON.stringify(a, null, ' ')+"<br/>");
		$("#content-container").append("b : "+JSON.stringify(b, null, ' ')+"<br/>");
		var ok = deepEqual(a,b);
		if(ok == resultNeeded)
			success++;
		else {
			failed++;
			//console.warning("deep-equal : needed result not matched : "+title+" ("+count+")")
		}
		$("#content-container").append("<strong style=\"color:#"+((ok  == resultNeeded )?"000000":"FF0000")+"\">test :</strong>", JSON.stringify(ok, null, ' ')+"<br/>");
	}
	var promises = [];

//	printInterlude("deep-equal");

	var view = new ViewController();
	view.applyLayer({
		context:{
			test:"/common/json/input-{{ __this.part }}.json#/testvar§{\"myProp\":12}",
			test2:"/common/json/input-{{ __this.part }}.json§{\"myProp\":12}#/testvar",
			test3:"json::/common/json/input-{{ __this.part }}.json§{\"myProp\":12}#/testvar"
		}
	});

	view.applyLayer({
		part:"context"
	});

	var deferred = promise.Deferred();
	view.load().then(function(view){
		console.log("layer loaded : ", JSON.stringify(view.context, null, ' '));
		doDeepEqualTest("interpretation simple", view.context, { 

				test:["TEST is OK"],
				test2:["TEST is OK"],
				test3:["TEST is OK"]

		}, true)
		//printReport("view-controller", success, failed, count);
		deferred.resolve(this);
	})
	promises.push(promise.promise(deferred));

//	printInterlude("inherits base layer");



	var baseLayer = {
		subs:{
			test:{
				controller:"instance::test-controller.js"
			}
		}
	}
	var view4 = new ViewController();
	view4.applyLayer({
		name:"view1",
		"inherits":[baseLayer],
		subs:{
			test:{
				context:{
					hola:"hello"
				}
			}
		}
	});
		
	var view5 = new ViewController();
	view5.applyLayer({
		name:"view5",
		"inherits":[baseLayer],
		subs:{
			test:{
				context:{
					hola:"bye"
				}
			}
		}
	});
	var deferred2 = promise.Deferred();
	promise.all([view4.load(), view5.load()]).then(function(views){
		doDeepEqualTest("inherits base layer with subs then customise subs", view4.subs.test.context, view5.subs.test.context, false);
		promise.all([view4.load(), view5.load()]).then(function(){
			doDeepEqualTest("second inherits base layer with subs then customise subs", view4.subs.test.context, view5.subs.test.context, false);
			deferred2.resolve(this);
		})
	})
	promises.push(promise.promise(deferred2));
	var baseLayer = {
		items:{
			test:{
				controller:"instance::test-controller.js"
			}
		}
	}

	var view = new ListController();
	view.applyLayer({
		name:"view1",
		"inherits":[baseLayer],
		items:{
			test:{
				context:{
					hola:"hello"
				}
			}
		}
	});
		
	var view2 = new ListController();
	view2.applyLayer({
		name:"view2",
		"inherits":[baseLayer],
		items:{
			test:{
				context:{
					hola:"bye"
				}
			}
		}
	});

	var deferred3 = promise.Deferred();
	promise.all([view.load(), view2.load()]).then(function(){
		doDeepEqualTest("inherits base layer with items then customise items", view.items.test.context, view2.items.test.context, false);
		promise.all([view.load(), view2.load()]).then(function(){
			doDeepEqualTest("second inherits base layer with items then customise items", view.items.test.context, view2.items.test.context, false);
			deferred3.resolve(this);
		})
	});

	promises.push(promise.promise(deferred3));

	promise.all(promises).then(function(){
		printReport("view-controller", success, failed, count);
	})


//_______________________________________________

var a = [{names:"john"},{names:"janis"},{names:"jim"}];

deep(a)
.query("./*")
.render({
    //what:"first::#./!",
    how:"swig::./templates/simple.html",
    where:function(rendered){
      return $(rendered).appendTo("#content-container");
    },
    done:function(nodes){
        $(nodes).click( function(e){ 
            console.log("click"); 
        })
    }
})
.log()
.logValues();

//_______________________________________________

var obj = {
  backgrounds:[ deep.ui.viewController ],
  datas:{ names:"john" },
  renderables:{
     self:{
        what:"first::#../../datas",
        how:"swig::./templates/simple.html",
        where:function(rendered){
            return $(rendered).appendTo("#content-container");
        },
        done:function(nodes){
            $(nodes).click( function(e){ 
                console.log("click"); 
            })
        }
     }
  }
}

deep(obj).flatten().run('refresh');

//_______________________________________________


})();
</script>